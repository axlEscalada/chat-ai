name: CI
on:
  push:
    branches: [main]
  pull_request:
    branches: [main]
jobs:
  run_autonoma_tests:
    runs-on: ubuntu-latest
    name: Run Autonoma Tests
    strategy:
      fail-fast: false
      matrix:
        include:
          - name: "Folder Tests"
            type: "folder"
            id: "cmbi84wla0178xv01zzf8o79n"
            action: "autonoma-ai/actions/folder-runner@v1"
          - name: "Single Test"
            type: "test"
            id: "cmabkzdea001zxk01sp1mnygy"
            action: "autonoma-ai/actions/test-runner@v1"
    steps:
      - name: Run ${{ matrix.name }}
        id: test-run
        uses: ${{ matrix.action }}
        continue-on-error: true
        with:
          ${{ matrix.type }}-id: ${{ matrix.id }}
          client-id: ${{ secrets.AUTONOMA_CLIENT_ID }}
          client-secret: ${{ secrets.AUTONOMA_CLIENT_SECRET }}
          max-wait-time: "10"
      - name: Show Results
        if: always()
        run: |
          echo "Test: ${{ matrix.name }}"
          echo "Status: ${{ steps.test-run.outputs.final-status }}"
          echo "Message: ${{ steps.test-run.outputs.message }}"
          echo "View results at: ${{ steps.test-run.outputs.url }}"
          echo "Outcome: ${{ steps.test-run.outcome }}"
      - name: Set Job Status
        if: steps.test-run.outcome == 'failure'
        run: exit 1
  summary:
    needs: run_autonoma_tests
    runs-on: ubuntu-latest
    if: always()
    steps:
      - name: Summary
        run: |
          echo "Test run completed"
          echo "Overall status: ${{ needs.run_autonoma_tests.result }}"

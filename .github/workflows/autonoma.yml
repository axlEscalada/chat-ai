name: CI
on:
  push:
    branches: [main]
  pull_request:
    branches: [main]
jobs:
  run_autonoma_tests:
    runs-on: ubuntu-latest
    name: Run Autonoma Tests
    steps:
      - name: Run Folder Tests (cmbi84wla0178xv01zzf8o79n)
        id: step-1
        uses: autonoma-ai/actions/folder-runner@v1
        with:
          folder-id: "cmbi84wla0178xv01zzf8o79n"
          client-id: ${{ secrets.AUTONOMA_CLIENT_ID }}
          client-secret: ${{ secrets.AUTONOMA_CLIENT_SECRET }}
          max-wait-time: "10"
      - name: Show test results
        if: always()
        run: |
          echo "Test status: ${{ steps.step-1.outputs.final-status }}"
          echo "Message: ${{ steps.step-1.outputs.message }}"
          echo "View results at: ${{ steps.step-1.outputs.url }}"
          echo "Run ID: ${{ steps.step-1.outputs.run-id }}"
      # Debug API connectivity (keeping your original curl)
      - name: Debug API connectivity
        if: failure()
        run: |
          echo "Debugging API connectivity..."
          curl -s -w "%{http_code}" \
            -H "autonoma-client-id: cmbgklqtz000ixv01dfusk0un" \
            -H "autonoma-client-secret: 8d1078d7f463fbb337d6a028567e24b1b2798ee7a9c4f24ca3e80c0e0fcfc955a85390c572ad18b3485a5802d2bf1b96" \
            -H "Content-Type: application/json" \
            --connect-timeout 60 \
            --max-time 60 \
            https://latest.prod.autonoma.app/api/run/folder/z8piqlr9dtg57y8qlrvdiqkf
